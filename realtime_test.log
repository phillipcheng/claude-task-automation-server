/Users/bytedance/python/claudeserver/app/main.py:37: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("startup")
INFO:     Started server process [21227]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
Database initialized: mysql+pymysql://root:sitebuilder@localhost/claudesys
INFO:     127.0.0.1:56250 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:56337 - "POST /api/v1/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:56459 - "POST /api/v1/tasks/by-name/realtime_interrupt_test/start HTTP/1.1" 200 OK
Task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03: No worktree configured, using fallback path: /tmp/claude_projects
üîç DEBUG: Adding user input to queue for task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03 (realtime_interrupt_test): 'INTERRUPT! Stop everything and just say hello worl...'
üîç UserInputManager DEBUG: Starting add_user_input for task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03, use_separate_session=True
üîç UserInputManager DEBUG: Using separate database session
üîç UserInputManager DEBUG: Found task realtime_interrupt_test
üîç UserInputManager DEBUG: Current queue: None
üîç UserInputManager DEBUG: Initialized empty queue
üîç UserInputManager DEBUG: Created input entry: {'id': 'fd4288af-c3c0-4b98-93ba-2a4267df1d8a', 'input': 'INTERRUPT! Stop everything and just say hello world instead', 'timestamp': '2025-10-25T03:51:19.218202', 'processed': False}
üîç UserInputManager DEBUG: Current queue before append: []
üîç UserInputManager DEBUG: Current queue after append: [{'id': 'fd4288af-c3c0-4b98-93ba-2a4267df1d8a', 'input': 'INTERRUPT! Stop everything and just say hello world instead', 'timestamp': '2025-10-25T03:51:19.218202', 'processed': False}]
üîç UserInputManager DEBUG: Set task.user_input_queue to: [{'id': 'fd4288af-c3c0-4b98-93ba-2a4267df1d8a', 'input': 'INTERRUPT! Stop everything and just say hello world instead', 'timestamp': '2025-10-25T03:51:19.218202', 'processed': False}] and flagged as modified
üîç UserInputManager DEBUG: About to commit...
‚úÖ UserInputManager DEBUG: Commit successful
üîç UserInputManager DEBUG: Post-commit verification - database shows queue: [{'id': 'fd4288af-c3c0-4b98-93ba-2a4267df1d8a', 'input': 'INTERRUPT! Stop everything and just say hello world instead', 'processed': False, 'timestamp': '2025-10-25T03:51:19.218202'}]
üîç UserInputManager DEBUG: Closed separate database session
üîç DEBUG: UserInputManager.add_user_input() returned: True
‚úÖ DEBUG: Successfully added user input to queue for task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03 with separate session
üîÑ Task realtime_interrupt_test is RUNNING but no active process - restarting task executor to process user input
üîç DEBUG: Before task executor restart - task.user_input_queue = None
‚úÖ Task executor restarted for realtime_interrupt_test - user input will be processed by task executor
üîç DEBUG: After task executor restart - task.user_input_queue = None
üîç DEBUG: After UserInputManager commit and refresh - task.user_input_queue = None
üîç DEBUG: About to commit legacy field for task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03
‚úÖ DEBUG: Legacy field commit completed for task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03
INFO:     127.0.0.1:56551 - "POST /api/v1/tasks/by-name/realtime_interrupt_test/set-input HTTP/1.1" 200 OK
Task b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03: No worktree configured, using fallback path: /tmp/claude_projects
üîç TASK EXECUTOR DEBUG: task_id=b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03, set claude_session_id=41a6171c-b7c9-4a73-83f9-dc5a1cc5e03e
üîç TASK EXECUTOR DEBUG: task_id=b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03, set claude_session_id=41a6171c-b7c9-4a73-83f9-dc5a1cc5e03e
INFO:     127.0.0.1:56738 - "GET /api/v1/tasks/by-name/realtime_interrupt_test/status HTTP/1.1" 200 OK
üîç TASK EXECUTOR DEBUG: task_id=b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03, set claude_session_id=41a6171c-b7c9-4a73-83f9-dc5a1cc5e03e
üîç TASK EXECUTOR DEBUG: task_id=b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03, set claude_session_id=41a6171c-b7c9-4a73-83f9-dc5a1cc5e03e
INFO:     127.0.0.1:56880 - "POST /api/v1/tasks HTTP/1.1" 200 OK
üîç TASK EXECUTOR DEBUG: task_id=b57e0ee5-3f25-42c1-82e9-c74bfc6f6b03, set claude_session_id=41a6171c-b7c9-4a73-83f9-dc5a1cc5e03e
INFO:     127.0.0.1:56958 - "POST /api/v1/tasks/by-name/slow_task_test/start HTTP/1.1" 200 OK
Task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724: No worktree configured, using fallback path: /tmp/claude_projects
üîç DEBUG: Adding user input to queue for task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724 (slow_task_test): 'STOP RIGHT NOW! Just write hello world instead...'
üîç UserInputManager DEBUG: Starting add_user_input for task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724, use_separate_session=True
üîç UserInputManager DEBUG: Using separate database session
üîç UserInputManager DEBUG: Found task slow_task_test
üîç UserInputManager DEBUG: Current queue: None
üîç UserInputManager DEBUG: Initialized empty queue
üîç UserInputManager DEBUG: Created input entry: {'id': '8f5d696f-288a-4bbb-92c5-29d84d92cef1', 'input': 'STOP RIGHT NOW! Just write hello world instead', 'timestamp': '2025-10-25T03:51:43.019271', 'processed': False}
üîç UserInputManager DEBUG: Current queue before append: []
üîç UserInputManager DEBUG: Current queue after append: [{'id': '8f5d696f-288a-4bbb-92c5-29d84d92cef1', 'input': 'STOP RIGHT NOW! Just write hello world instead', 'timestamp': '2025-10-25T03:51:43.019271', 'processed': False}]
üîç UserInputManager DEBUG: Set task.user_input_queue to: [{'id': '8f5d696f-288a-4bbb-92c5-29d84d92cef1', 'input': 'STOP RIGHT NOW! Just write hello world instead', 'timestamp': '2025-10-25T03:51:43.019271', 'processed': False}] and flagged as modified
üîç UserInputManager DEBUG: About to commit...
‚úÖ UserInputManager DEBUG: Commit successful
üîç UserInputManager DEBUG: Post-commit verification - database shows queue: [{'id': '8f5d696f-288a-4bbb-92c5-29d84d92cef1', 'input': 'STOP RIGHT NOW! Just write hello world instead', 'processed': False, 'timestamp': '2025-10-25T03:51:43.019271'}]
üîç UserInputManager DEBUG: Closed separate database session
üîç DEBUG: UserInputManager.add_user_input() returned: True
‚úÖ DEBUG: Successfully added user input to queue for task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724 with separate session
üîÑ Task slow_task_test is RUNNING but no active process - restarting task executor to process user input
üîç DEBUG: Before task executor restart - task.user_input_queue = None
‚úÖ Task executor restarted for slow_task_test - user input will be processed by task executor
üîç DEBUG: After task executor restart - task.user_input_queue = None
üîç DEBUG: After UserInputManager commit and refresh - task.user_input_queue = None
üîç DEBUG: About to commit legacy field for task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724
‚úÖ DEBUG: Legacy field commit completed for task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724
INFO:     127.0.0.1:56965 - "POST /api/v1/tasks/by-name/slow_task_test/set-input HTTP/1.1" 200 OK
Task 4f5dd6da-bb64-4ee0-a6a3-c3a990169724: No worktree configured, using fallback path: /tmp/claude_projects
üîç TASK EXECUTOR DEBUG: task_id=4f5dd6da-bb64-4ee0-a6a3-c3a990169724, set claude_session_id=4e355f68-65fe-447d-8485-c7d20b6a64b6
üîç TASK EXECUTOR DEBUG: task_id=4f5dd6da-bb64-4ee0-a6a3-c3a990169724, set claude_session_id=4e355f68-65fe-447d-8485-c7d20b6a64b6
üîç TASK EXECUTOR DEBUG: task_id=4f5dd6da-bb64-4ee0-a6a3-c3a990169724, set claude_session_id=4e355f68-65fe-447d-8485-c7d20b6a64b6
üîç TASK EXECUTOR DEBUG: task_id=4f5dd6da-bb64-4ee0-a6a3-c3a990169724, set claude_session_id=4e355f68-65fe-447d-8485-c7d20b6a64b6
INFO:     127.0.0.1:57309 - "GET /api/v1/tasks/by-name/slow_task_test/conversation HTTP/1.1" 200 OK
üîç TASK EXECUTOR DEBUG: task_id=4f5dd6da-bb64-4ee0-a6a3-c3a990169724, set claude_session_id=4e355f68-65fe-447d-8485-c7d20b6a64b6
üîç TASK EXECUTOR DEBUG: task_id=4f5dd6da-bb64-4ee0-a6a3-c3a990169724, set claude_session_id=cacd9e77-c10d-49f9-bc11-3b076996e135
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/slow_task_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks/by-name/realtime_interrupt_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks/by-name/interrupt_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "GET /api/v1/tasks/by-name/user_input_final_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/real_time_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59583 - "GET /api/v1/tasks/by-name/test_user_input_fix/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "DELETE /api/v1/tasks/by-name/slow_task_test HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks/by-name/realtime_interrupt_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59583 - "GET /api/v1/tasks/by-name/interrupt_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/real_time_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/user_input_final_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "GET /api/v1/tasks/by-name/test_user_input_fix/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "DELETE /api/v1/tasks/by-name/realtime_interrupt_test HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59576 - "GET /api/v1/tasks/by-name/interrupt_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks/by-name/real_time_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/test_user_input_fix/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "GET /api/v1/tasks/by-name/user_input_final_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59583 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59583 - "DELETE /api/v1/tasks/by-name/interrupt_test HTTP/1.1" 200 OK
INFO:     127.0.0.1:59583 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59583 - "GET /api/v1/tasks/by-name/real_time_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/test_user_input_fix/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "GET /api/v1/tasks/by-name/user_input_final_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "DELETE /api/v1/tasks/by-name/real_time_test HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59582 - "GET /api/v1/tasks/by-name/user_input_final_test/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks/by-name/test_user_input_fix/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "DELETE /api/v1/tasks/by-name/user_input_final_test HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59578 - "GET /api/v1/tasks/by-name/test_user_input_fix/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/bytedance/python/claudeserver/app/services/task_executor.py", line 347, in _execute_with_claude
    response, pid, returned_session_id, usage_data = await self.streaming_client.send_message_streaming(
                                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "/Users/bytedance/python/claudeserver/app/services/streaming_cli_client.py", line 98, in send_message_streaming
    event_callback(event)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/bytedance/python/claudeserver/app/services/task_executor.py", line 307, in handle_event
    db, task.id, InteractionType.CLAUDE_RESPONSE, content_str
        ^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/loading.py", line 1686, in load_scalar_attributes
    raise orm_exc.ObjectDeletedError(state)
sqlalchemy.orm.exc.ObjectDeletedError: Instance '<Task at 0x108a01310>' has been deleted, or its row is otherwise not present.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/bytedance/python/claudeserver/app/services/task_executor.py", line 119, in execute_task
    await self._execute_with_claude(db, task, project_path)
  File "/Users/bytedance/python/claudeserver/app/services/task_executor.py", line 408, in _execute_with_claude
    db.commit()
    ~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2030, in commit
    trans.commit(_to_root=True)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "<string>", line 2, in commit
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1311, in commit
    self._prepare_impl()
    ~~~~~~~~~~~~~~~~~~^^
  File "<string>", line 2, in _prepare_impl
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 1286, in _prepare_impl
    self.session.flush()
    ~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4331, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4466, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4427, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        update,
        ^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 781, in _emit_update_statements
    ) in groupby(
         ~~~~~~~^
        update,
        ^^^^^^^
    ...<6 lines>...
        ),
        ^^
    ):
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 577, in _collect_update_commands
    history = state.manager[propkey].impl.get_history(
        state, state_dict, attributes.PASSIVE_OFF
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/attributes.py", line 1265, in get_history
    current = self.get(state, dict_, passive=passive)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/loading.py", line 1686, in load_scalar_attributes
    raise orm_exc.ObjectDeletedError(state)
sqlalchemy.orm.exc.ObjectDeletedError: Instance '<Task at 0x108a01310>' has been deleted, or its row is otherwise not present.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/fastapi/routing.py", line 110, in app
    await response(scope, receive, send)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/responses.py", line 168, in __call__
    await self.background()
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/background.py", line 42, in __call__
    await task()
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/starlette/background.py", line 27, in __call__
    await self.func(*self.args, **self.kwargs)
  File "/Users/bytedance/python/claudeserver/app/services/task_executor.py", line 122, in execute_task
    task = db.query(Task).filter(Task.id == task_id).first()
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ~~~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
        params,
        ^^^^^^^
        execution_options={"_sa_orm_load_options": self.load_options},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2239, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 2108, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/state_changes.py", line 101, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 971, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
    ...<6 lines>...
    )
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: Instance '<Task at 0x108a01310>' has been deleted, or its row is otherwise not present. (Background on this error at: https://sqlalche.me/e/20/7s2a)
INFO:     127.0.0.1:59573 - "DELETE /api/v1/tasks/by-name/test_user_input_fix HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59573 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "POST /api/v1/tasks/by-name/add_scene_event_codes_to_stra/clear-and-restart HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks?limit=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59580 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/live_demo/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:59775 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:59899 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
üîç DEBUG: Adding user input to queue for task 8d71a584-a288-4993-bca2-c445249c7d1a (add_scene_event_codes_to_stra): 'how many files you have scanned...'
üîç UserInputManager DEBUG: Starting add_user_input for task 8d71a584-a288-4993-bca2-c445249c7d1a, use_separate_session=True
üîç UserInputManager DEBUG: Using separate database session
üîç UserInputManager DEBUG: Found task add_scene_event_codes_to_stra
üîç UserInputManager DEBUG: Current queue: [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}]
üîç UserInputManager DEBUG: Created input entry: {'id': 'fef4a3b8-ea7d-4911-b4db-204d917d4e6c', 'input': 'how many files you have scanned', 'timestamp': '2025-10-25T03:57:23.783819', 'processed': False}
üîç UserInputManager DEBUG: Current queue before append: [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}]
üîç UserInputManager DEBUG: Current queue after append: [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}, {'id': 'fef4a3b8-ea7d-4911-b4db-204d917d4e6c', 'input': 'how many files you have scanned', 'timestamp': '2025-10-25T03:57:23.783819', 'processed': False}]
üîç UserInputManager DEBUG: Set task.user_input_queue to: [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}, {'id': 'fef4a3b8-ea7d-4911-b4db-204d917d4e6c', 'input': 'how many files you have scanned', 'timestamp': '2025-10-25T03:57:23.783819', 'processed': False}] and flagged as modified
üîç UserInputManager DEBUG: About to commit...
‚úÖ UserInputManager DEBUG: Commit successful
üîç UserInputManager DEBUG: Post-commit verification - database shows queue: [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}, {'id': 'fef4a3b8-ea7d-4911-b4db-204d917d4e6c', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:57:23.783819'}]
üîç UserInputManager DEBUG: Closed separate database session
üîç DEBUG: UserInputManager.add_user_input() returned: True
‚úÖ DEBUG: Successfully added user input to queue for task 8d71a584-a288-4993-bca2-c445249c7d1a with separate session
üîÑ Task add_scene_event_codes_to_stra is RUNNING but no active process - restarting task executor to process user input
üîç DEBUG: Before task executor restart - task.user_input_queue = [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}]
‚úÖ Task executor restarted for add_scene_event_codes_to_stra - user input will be processed by task executor
üîç DEBUG: After task executor restart - task.user_input_queue = [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}]
üîç DEBUG: After UserInputManager commit and refresh - task.user_input_queue = [{'id': '653fdeb2-5233-46e9-89aa-308b5211c856', 'input': 'DETAILED TEST 1: How many Go files did you scan in the project? Please give me a specific count.', 'processed': False, 'timestamp': '2025-10-25T03:25:17.221025'}, {'id': 'da7df572-be43-4b3a-9f19-4a0bc69594bb', 'input': 'DETAILED TEST 2: I notice my first message is still pending. Can you see this second message?', 'processed': False, 'timestamp': '2025-10-25T03:26:23.935053'}, {'id': '515871d8-5800-43f7-8106-489b184182bc', 'input': 'how many files you scanned?', 'processed': False, 'timestamp': '2025-10-25T03:39:53.705945'}, {'id': 'eef21e02-c854-42a6-b95b-00f90e22bde5', 'input': 'how many files you have scanned', 'processed': False, 'timestamp': '2025-10-25T03:40:42.149771'}]
üîç DEBUG: About to commit legacy field for task 8d71a584-a288-4993-bca2-c445249c7d1a
‚úÖ DEBUG: Legacy field commit completed for task 8d71a584-a288-4993-bca2-c445249c7d1a
INFO:     127.0.0.1:59899 - "POST /api/v1/tasks/by-name/add_scene_event_codes_to_stra/set-input HTTP/1.1" 200 OK
INFO:     127.0.0.1:59899 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:60022 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=fb2eba30-3342-4e29-9383-3b200f4e65d2
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=fb2eba30-3342-4e29-9383-3b200f4e65d2
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=fb2eba30-3342-4e29-9383-3b200f4e65d2
INFO:     127.0.0.1:60661 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
Claude CLI executing in current directory (no project_path specified)
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=fb2eba30-3342-4e29-9383-3b200f4e65d2
INFO:     127.0.0.1:60780 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:60780 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:60780 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:60780 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:60780 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
Claude CLI executing in current directory (no project_path specified)
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=fb2eba30-3342-4e29-9383-3b200f4e65d2
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=38fa6327-9206-4391-b263-938d7be6906e
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=38fa6327-9206-4391-b263-938d7be6906e
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=38fa6327-9206-4391-b263-938d7be6906e
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=38fa6327-9206-4391-b263-938d7be6906e
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=38fa6327-9206-4391-b263-938d7be6906e
üîç TASK EXECUTOR DEBUG: task_id=8d71a584-a288-4993-bca2-c445249c7d1a, set claude_session_id=38fa6327-9206-4391-b263-938d7be6906e
INFO:     127.0.0.1:65489 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra HTTP/1.1" 200 OK
INFO:     127.0.0.1:65489 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/status HTTP/1.1" 200 OK
INFO:     127.0.0.1:65489 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:50884 - "GET /api/v1/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:50936 - "GET /api/v1/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:51025 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/conversation HTTP/1.1" 200 OK
INFO:     127.0.0.1:51483 - "GET /api/v1/tasks/by-name/add_scene_event_codes_to_stra/input-queue-status HTTP/1.1" 200 OK
INFO:     127.0.0.1:51758 - "POST /api/v1/tasks/by-name/add_scene_event_codes_to_stra/stop HTTP/1.1" 200 OK
INFO:     127.0.0.1:51817 - "POST /api/v1/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:51864 - "POST /api/v1/tasks/by-name/clean_user_input_test/start HTTP/1.1" 200 OK
Task 0cb1b7ba-f43d-4898-acad-264379639fbc: No worktree configured, using fallback path: /tmp/claude_projects
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç DEBUG: Adding user input to queue for task 0cb1b7ba-f43d-4898-acad-264379639fbc (clean_user_input_test): 'My favorite language is Python...'
üîç UserInputManager DEBUG: Starting add_user_input for task 0cb1b7ba-f43d-4898-acad-264379639fbc, use_separate_session=True
üîç UserInputManager DEBUG: Using separate database session
üîç UserInputManager DEBUG: Found task clean_user_input_test
üîç UserInputManager DEBUG: Current queue: None
üîç UserInputManager DEBUG: Initialized empty queue
üîç UserInputManager DEBUG: Created input entry: {'id': '001ca572-53ef-45eb-9fff-238ab013608c', 'input': 'My favorite language is Python', 'timestamp': '2025-10-25T04:10:30.802102', 'processed': False}
üîç UserInputManager DEBUG: Current queue before append: []
üîç UserInputManager DEBUG: Current queue after append: [{'id': '001ca572-53ef-45eb-9fff-238ab013608c', 'input': 'My favorite language is Python', 'timestamp': '2025-10-25T04:10:30.802102', 'processed': False}]
üîç UserInputManager DEBUG: Set task.user_input_queue to: [{'id': '001ca572-53ef-45eb-9fff-238ab013608c', 'input': 'My favorite language is Python', 'timestamp': '2025-10-25T04:10:30.802102', 'processed': False}] and flagged as modified
üîç UserInputManager DEBUG: About to commit...
‚úÖ UserInputManager DEBUG: Commit successful
üîç UserInputManager DEBUG: Post-commit verification - database shows queue: [{'id': '001ca572-53ef-45eb-9fff-238ab013608c', 'input': 'My favorite language is Python', 'processed': False, 'timestamp': '2025-10-25T04:10:30.802102'}]
üîç UserInputManager DEBUG: Closed separate database session
üîç DEBUG: UserInputManager.add_user_input() returned: True
‚úÖ DEBUG: Successfully added user input to queue for task 0cb1b7ba-f43d-4898-acad-264379639fbc with separate session
üîÑ Task clean_user_input_test is RUNNING but no active process - restarting task executor to process user input
üîç DEBUG: Before task executor restart - task.user_input_queue = None
‚úÖ Task executor restarted for clean_user_input_test - user input will be processed by task executor
üîç DEBUG: After task executor restart - task.user_input_queue = None
üîç DEBUG: After UserInputManager commit and refresh - task.user_input_queue = None
üîç DEBUG: About to commit legacy field for task 0cb1b7ba-f43d-4898-acad-264379639fbc
‚úÖ DEBUG: Legacy field commit completed for task 0cb1b7ba-f43d-4898-acad-264379639fbc
INFO:     127.0.0.1:52020 - "POST /api/v1/tasks/by-name/clean_user_input_test/set-input HTTP/1.1" 200 OK
Task 0cb1b7ba-f43d-4898-acad-264379639fbc: No worktree configured, using fallback path: /tmp/claude_projects
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
INFO:     127.0.0.1:52260 - "GET /api/v1/tasks/by-name/clean_user_input_test/conversation HTTP/1.1" 200 OK
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
üîç TASK EXECUTOR DEBUG: task_id=0cb1b7ba-f43d-4898-acad-264379639fbc, set claude_session_id=1883e3e0-0067-4842-a04c-b632dbf0c146
INFO:     127.0.0.1:53067 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:53119 - "POST /api/v1/tasks HTTP/1.1" 200 OK
INFO:     127.0.0.1:53167 - "POST /api/v1/tasks/by-name/final_message_test/start HTTP/1.1" 200 OK
Task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d: No worktree configured, using fallback path: /tmp/claude_projects
üîç TASK EXECUTOR DEBUG: task_id=d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, set claude_session_id=581bec83-0c65-4e1a-aff6-0b14106d7977
üîç DEBUG: Adding user input to queue for task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d (final_message_test): 'My name is Alex...'
üîç UserInputManager DEBUG: Starting add_user_input for task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, use_separate_session=True
üîç UserInputManager DEBUG: Using separate database session
üîç UserInputManager DEBUG: Found task final_message_test
üîç UserInputManager DEBUG: Current queue: None
üîç UserInputManager DEBUG: Initialized empty queue
üîç UserInputManager DEBUG: Created input entry: {'id': '23901dba-b791-470c-9205-4a5f9bc3b537', 'input': 'My name is Alex', 'timestamp': '2025-10-25T04:12:14.344650', 'processed': False}
üîç UserInputManager DEBUG: Current queue before append: []
üîç UserInputManager DEBUG: Current queue after append: [{'id': '23901dba-b791-470c-9205-4a5f9bc3b537', 'input': 'My name is Alex', 'timestamp': '2025-10-25T04:12:14.344650', 'processed': False}]
üîç UserInputManager DEBUG: Set task.user_input_queue to: [{'id': '23901dba-b791-470c-9205-4a5f9bc3b537', 'input': 'My name is Alex', 'timestamp': '2025-10-25T04:12:14.344650', 'processed': False}] and flagged as modified
üîç UserInputManager DEBUG: About to commit...
‚úÖ UserInputManager DEBUG: Commit successful
üîç UserInputManager DEBUG: Post-commit verification - database shows queue: [{'id': '23901dba-b791-470c-9205-4a5f9bc3b537', 'input': 'My name is Alex', 'processed': False, 'timestamp': '2025-10-25T04:12:14.344650'}]
üîç UserInputManager DEBUG: Closed separate database session
üîç DEBUG: UserInputManager.add_user_input() returned: True
‚úÖ DEBUG: Successfully added user input to queue for task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d with separate session
üîÑ Task final_message_test is RUNNING but no active process - restarting task executor to process user input
üîç DEBUG: Before task executor restart - task.user_input_queue = None
‚úÖ Task executor restarted for final_message_test - user input will be processed by task executor
üîç DEBUG: After task executor restart - task.user_input_queue = None
üîç DEBUG: After UserInputManager commit and refresh - task.user_input_queue = None
üîç DEBUG: About to commit legacy field for task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d
‚úÖ DEBUG: Legacy field commit completed for task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d
INFO:     127.0.0.1:53354 - "POST /api/v1/tasks/by-name/final_message_test/set-input HTTP/1.1" 200 OK
Task d98c838b-e1f6-4d78-9f65-4a944d3b0d6d: No worktree configured, using fallback path: /tmp/claude_projects
üîç TASK EXECUTOR DEBUG: task_id=d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, set claude_session_id=581bec83-0c65-4e1a-aff6-0b14106d7977
üîç TASK EXECUTOR DEBUG: task_id=d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, set claude_session_id=581bec83-0c65-4e1a-aff6-0b14106d7977
üîç TASK EXECUTOR DEBUG: task_id=d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, set claude_session_id=581bec83-0c65-4e1a-aff6-0b14106d7977
INFO:     127.0.0.1:53563 - "GET /api/v1/tasks/by-name/final_message_test/input-queue-status HTTP/1.1" 200 OK
üîç TASK EXECUTOR DEBUG: task_id=d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, set claude_session_id=581bec83-0c65-4e1a-aff6-0b14106d7977
üîç TASK EXECUTOR DEBUG: task_id=d98c838b-e1f6-4d78-9f65-4a944d3b0d6d, set claude_session_id=581bec83-0c65-4e1a-aff6-0b14106d7977
INFO:     127.0.0.1:53682 - "GET /api/v1/tasks/by-name/final_message_test/conversation HTTP/1.1" 200 OK
